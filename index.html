<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–ö–≤–µ—Å—Ç 2026 ‚Äì –ö–æ–ª–æ–Ω–∏–∑–∞—Ü–∏—è –Æ–ø–∏—Ç–µ—Ä–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== –û–ë–©–ò–ï –°–¢–ò–õ–ò ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Arial, sans-serif;
        }

        :root {
            --space-dark: #0b0d1e;
            --space-purple: #1a1a3a;
            --neon-blue: #4e54f5;
            --neon-cyan: #3dc2ec;
            --neon-pink: #f72585;
            --neon-green: #06d6a0;
            --star-color: rgba(255,255,255,0.9);
            --card-bg: rgba(20,25,45,0.9);
            --text-light: #f0f0f0;
            --text-dim: #aaa;
        }

        body {
            background: radial-gradient(ellipse at top, #1a1a3a, #0a0a1a);
            min-height: 100vh;
            padding: 8px;
            position: relative;
            overflow-x: hidden;
        }

        /* –ó–≤—ë–∑–¥–Ω—ã–π —Ñ–æ–Ω */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(2px 2px at 10px 20px, var(--star-color), transparent),
                radial-gradient(2px 2px at 30px 70px, var(--star-color), transparent),
                radial-gradient(3px 3px at 80px 40px, var(--star-color), transparent),
                radial-gradient(1px 1px at 150px 180px, var(--star-color), transparent),
                radial-gradient(2px 2px at 250px 300px, var(--star-color), transparent),
                radial-gradient(3px 3px at 350px 150px, var(--star-color), transparent);
            background-repeat: repeat;
            pointer-events: none;
            z-index: -1;
            animation: twinkle 4s infinite alternate;
        }

        @keyframes twinkle { 0% { opacity: 0.7; } 100% { opacity: 1; } }

        .container { max-width: 1400px; margin: 0 auto; }

        .app {
            background: rgba(10,15,30,0.7);
            backdrop-filter: blur(12px);
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            overflow: hidden;
            min-height: 90vh;
            color: var(--text-light);
        }

        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1); flex-wrap: wrap; gap: 10px;
        }

        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon {
            width: 45px; height: 45px; background: linear-gradient(145deg, var(--neon-blue), var(--neon-cyan));
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: white; box-shadow: 0 0 15px var(--neon-blue);
        }
        .logo-text h1 {
            font-size: 20px; font-weight: 600; background: linear-gradient(135deg, #fff, #b0b0ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .logo-text p { font-size: 12px; color: var(--text-dim); }

        .user-info {
            display: flex; align-items: center; gap: 12px; background: rgba(0,0,0,0.5);
            padding: 6px 15px; border-radius: 40px; border: 1px solid rgba(255,255,255,0.15);
        }
        .impulse-badge {
            background: linear-gradient(145deg, var(--neon-green), #0a9); color: #000;
            font-weight: bold; padding: 5px 12px; border-radius: 30px; font-size: 14px;
            display: flex; align-items: center; gap: 6px; box-shadow: 0 0 12px var(--neon-green);
        }

        .btn {
            padding: 10px 20px; border: none; border-radius: 40px; font-size: 15px;
            font-weight: 600; cursor: pointer; transition: all 0.2s;
            display: inline-flex; align-items: center; justify-content: center; gap: 6px;
            background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,0,0,0.5); border-color: var(--neon-cyan); }
        .btn-primary { background: linear-gradient(145deg, var(--neon-blue), #3a3fd4); border: none; }
        .btn-success { background: linear-gradient(145deg, var(--neon-green), #059669); border: none; }
        .btn-danger { background: linear-gradient(145deg, var(--neon-pink), #c41e6b); border: none; }
        .btn-info { background: linear-gradient(145deg, #17a2b8, #117a8b); border: none; }
        .btn-outline { background: transparent; border: 2px solid var(--neon-cyan); color: var(--neon-cyan); }
        .btn-warning { background: linear-gradient(145deg, #f8961e, #e07c0c); border: none; }

        .tabs {
            display: flex; gap: 4px; background: rgba(0,0,0,0.3); padding: 6px;
            border-radius: 50px; margin-bottom: 20px; overflow-x: auto; flex-wrap: nowrap;
        }
        .tab-btn {
            padding: 8px 16px; border-radius: 40px; background: transparent;
            border: none; color: var(--text-dim); font-weight: 600; cursor: pointer;
            transition: 0.2s; font-size: 14px; white-space: nowrap;
        }
        .tab-btn.active { background: var(--neon-blue); color: white; box-shadow: 0 0 12px var(--neon-blue); }

        .dashboard { padding: 20px; }

        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px; margin-bottom: 25px;
        }
        .stat-card {
            background: var(--card-bg); border-radius: 25px; padding: 18px;
            border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }
        .stat-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .stat-icon {
            width: 45px; height: 45px; border-radius: 18px; background: rgba(78,84,245,0.2);
            display: flex; align-items: center; justify-content: center; font-size: 22px;
            color: var(--neon-cyan);
        }
        .stat-value {
            font-size: 32px; font-weight: 700; line-height: 1;
            background: linear-gradient(135deg, #fff, #b0b0ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .stat-label { font-size: 12px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; }

        .shop-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px; margin-top: 15px;
        }
        .product-card {
            background: var(--card-bg); border-radius: 25px; padding: 18px;
            border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(5px);
            transition: 0.2s; display: flex; flex-direction: column; align-items: center;
            text-align: center;
        }
        .product-card:hover { transform: translateY(-4px); border-color: var(--neon-cyan); box-shadow: 0 10px 25px rgba(0,255,255,0.15); }
        .product-icon {
            width: 80px; height: 80px; background: rgba(78,84,245,0.2);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 40px; color: var(--neon-cyan); margin-bottom: 15px;
            border: 2px solid transparent; transition: 0.2s;
        }
        .product-card:hover .product-icon { border-color: var(--neon-cyan); box-shadow: 0 0 25px var(--neon-cyan); }
        .product-name { font-size: 18px; font-weight: 600; margin-bottom: 5px; }
        .product-description { font-size: 13px; color: var(--text-dim); margin-bottom: 15px; }
        .product-price {
            font-size: 20px; font-weight: 700; color: var(--neon-green);
            margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn-buy {
            width: 100%; padding: 12px; border-radius: 40px;
            background: linear-gradient(145deg, var(--neon-blue), #3a3fd4);
            border: none; color: white; font-weight: 600; font-size: 14px;
            cursor: pointer; transition: 0.2s;
        }
        .btn-buy:hover { transform: scale(1.02); box-shadow: 0 0 15px var(--neon-blue); }
        .btn-buy:disabled { opacity: 0.5; pointer-events: none; }

        .table-container {
            background: var(--card-bg); border-radius: 25px; padding: 16px;
            border: 1px solid rgba(255,255,255,0.05); margin-bottom: 20px; overflow-x: auto;
        }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th {
            text-align: left; padding: 12px; background: rgba(0,0,0,0.3);
            color: var(--neon-cyan); font-weight: 600; border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
        }
        td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        tr:hover { background: rgba(255,255,255,0.03); }

        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(8px);
            align-items: center; justify-content: center; z-index: 1000;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--card-bg); border-radius: 30px; padding: 25px;
            max-width: 95%; width: 400px; border: 1px solid rgba(255,255,255,0.1);
            max-height: 85vh; overflow-y: auto;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { color: white; font-size: 20px; }
        .modal-close { background: none; border: none; font-size: 28px; color: var(--text-dim); cursor: pointer; }
        .modal-close:hover { color: white; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; color: var(--text-dim); font-weight: 500; font-size: 14px; }
        .form-control {
            width: 100%; padding: 14px 18px; border-radius: 40px; border: none;
            background: rgba(0,0,0,0.5); color: white; font-size: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .form-control:focus { outline: none; border-color: var(--neon-cyan); }

        .notification {
            position: fixed; bottom: 20px; right: 20px; padding: 14px 25px;
            border-radius: 50px; background: var(--card-bg); border-left: 6px solid var(--neon-green);
            color: white; font-weight: 600; z-index: 2000; display: none;
            animation: slideIn 0.3s; backdrop-filter: blur(10px); box-shadow: 0 8px 25px black;
            font-size: 14px; max-width: 90%;
        }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .notification.success { border-left-color: var(--neon-green); }
        .notification.error { border-left-color: var(--neon-pink); }
        .notification.warning { border-left-color: #f8961e; }

        .btn-icon { padding: 8px 10px; margin: 0 2px; font-size: 14px; }

        .status-badge {
            display: inline-block; padding: 3px 8px; border-radius: 20px;
            font-size: 11px; font-weight: 600; text-transform: uppercase;
            background: rgba(0,0,0,0.5);
        }
        .status-badge.–∫—É–ø–ª–µ–Ω–æ { color: #aaa; border: 1px solid #aaa; }
        .status-badge.—Å—Ç—Ä–æ–∏—Ç—Å—è { color: #f8961e; border: 1px solid #f8961e; }
        .status-badge.—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç { color: #06d6a0; border: 1px solid #06d6a0; }

        @media (max-width: 600px) {
            .header { flex-direction: column; align-items: stretch; }
            .tabs { justify-content: flex-start; }
            .dashboard { padding: 15px; }
            .shop-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app">
            <!-- ========== –≠–ö–†–ê–ù –í–•–û–î–ê ========== -->
            <div id="loginScreen" class="screen active">
                <div class="header">
                    <div class="logo">
                        <div class="logo-icon"><i class="fas fa-rocket"></i></div>
                        <div class="logo-text">
                            <h1>–ö–≤–µ—Å—Ç 2026</h1>
                            <p>–ö–æ–ª–æ–Ω–∏–∑–∞—Ü–∏—è –Æ–ø–∏—Ç–µ—Ä–∞</p>
                        </div>
                    </div>
                    <div class="version" style="color: var(--text-dim);">v5.0</div>
                </div>
                <div style="display: flex; justify-content: center; align-items: center; min-height: 60vh; padding: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr; gap: 20px; width: 100%; max-width: 400px;">
                        <!-- –í—Ö–æ–¥ –∫–æ–º–∞–Ω–¥—ã -->
                        <div class="stat-card" style="text-align: center;">
                            <div class="stat-icon" style="margin: 0 auto 15px;"><i class="fas fa-users"></i></div>
                            <h2 style="margin-bottom: 15px;">–£—á–∞—Å—Ç–Ω–∏–∫</h2>
                            <p style="margin-bottom: 20px; color: var(--text-dim);">–í–æ–π–¥–∏—Ç–µ –ø–æ –∫–æ–¥—É –∫–æ–º–∞–Ω–¥—ã</p>
                            <div class="form-group">
                                <input type="text" id="teamCodeInput" class="form-control" placeholder="–ö–æ–¥ (6 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="6">
                            </div>
                            <button onclick="loginAsTeam()" class="btn btn-primary" style="width:100%;">
                                <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                            </button>
                        </div>
                        <!-- –í—Ö–æ–¥ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ -->
                        <div class="stat-card" style="text-align: center;">
                            <div class="stat-icon" style="margin: 0 auto 15px;"><i class="fas fa-crown"></i></div>
                            <h2 style="margin-bottom: 15px;">–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</h2>
                            <p style="margin-bottom: 20px; color: var(--text-dim);">–î–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é</p>
                            <div class="form-group">
                                <input type="password" id="adminPasswordInput" class="form-control" placeholder="–ü–∞—Ä–æ–ª—å">
                            </div>
                            <button onclick="loginAsAdmin()" class="btn btn-success" style="width:100%;">
                                <i class="fas fa-lock"></i> –í–æ–π—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== –≠–ö–†–ê–ù –£–ß–ê–°–¢–ù–ò–ö–ê ========== -->
            <div id="teamScreen" class="screen">
                <div class="header">
                    <div class="logo">
                        <button onclick="logout()" class="btn btn-outline" style="padding: 8px 12px;"><i class="fas fa-arrow-left"></i></button>
                        <div class="logo-icon"><i class="fas fa-galaxy"></i></div>
                        <div class="logo-text">
                            <h1 id="teamNameHeader">–ö–æ–º–∞–Ω–¥–∞</h1>
                            <p>–ò–º–ø—É–ª—å—Å—ã: <span id="teamScoreHeader">0</span></p>
                        </div>
                    </div>
                    <div class="user-info">
                        <span class="impulse-badge"><i class="fas fa-bolt"></i> <span id="teamScoreBadge">0</span></span>
                        <button onclick="refreshTeamData()" class="btn" style="padding:8px;"><i class="fas fa-sync-alt"></i></button>
                    </div>
                </div>

                <div class="dashboard">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchTeamTab('dashboard')">üìä –î–∞—à–±–æ—Ä–¥</button>
                        <button class="tab-btn" onclick="switchTeamTab('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
                        <button class="tab-btn" onclick="switchTeamTab('inventory')">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
                        <button class="tab-btn" onclick="switchTeamTab('finance')">üí∞ –§–∏–Ω–∞–Ω—Å—ã</button>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –î–ê–®–ë–û–†–î -->
                    <div id="teamDashboardTab" style="display: block;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-header"><div class="stat-icon"><i class="fas fa-bolt"></i></div></div>
                                <div class="stat-value" id="myScore">0</div>
                                <div class="stat-label">–ú–æ–∏ –∏–º–ø—É–ª—å—Å—ã</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header"><div class="stat-icon"><i class="fas fa-trophy"></i></div></div>
                                <div class="stat-value" id="myPosition">-</div>
                                <div class="stat-label">–ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header"><div class="stat-icon"><i class="fas fa-users"></i></div></div>
                                <div class="stat-value" id="totalTeamsCount">0</div>
                                <div class="stat-label">–í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥</div>
                            </div>
                        </div>

                        <!-- –ö–æ–Ω—Ç—Ä–∞–∫—Ç -->
                        <div class="table-container">
                            <h3 style="margin-bottom:15px;"><i class="fas fa-file-contract"></i> –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç</h3>
                            <div id="contractInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                            <button onclick="checkContract()" class="btn btn-warning" style="margin-top:10px;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</button>
                        </div>

                        <div class="table-container">
                            <h3 style="margin-bottom:15px;"><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</h3>
                            <div id="historyTable">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>

                        <div class="table-container">
                            <h3 style="margin-bottom:15px;"><i class="fas fa-chart-line"></i> –†–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥</h3>
                            <div id="ratingTable">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –ú–ê–ì–ê–ó–ò–ù -->
                    <div id="teamShopTab" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h2><i class="fas fa-store"></i> –ó–¥–∞–Ω–∏—è –Æ–ø–∏—Ç–µ—Ä–∞</h2>
                            <span class="impulse-badge">–ë–∞–ª–∞–Ω—Å: <span id="shopImpulseBalance">0</span></span>
                        </div>
                        <div id="shopItemsGrid" class="shop-grid">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –ò–ù–í–ï–ù–¢–ê–†–¨ -->
                    <div id="teamInventoryTab" style="display: none;">
                        <h2 style="margin-bottom: 15px;"><i class="fas fa-box"></i> –ú–æ–∏ –ø–æ—Å—Ç—Ä–æ–π–∫–∏</h2>
                        <div id="inventoryGrid" class="shop-grid">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è...</div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –§–ò–ù–ê–ù–°–´ (–∫—Ä–µ–¥–∏—Ç—ã, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏) -->
                    <div id="teamFinanceTab" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="investmentsValue">0</div>
                                <div class="stat-label">–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ —Ñ–æ–Ω–¥</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="loanValue">0</div>
                                <div class="stat-label">–¢–µ–∫—É—â–∏–π –∫—Ä–µ–¥–∏—Ç</div>
                            </div>
                        </div>
                        <div class="table-container">
                            <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                <button onclick="investInFund()" class="btn btn-success">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–æ–Ω–¥</button>
                                <button onclick="takeLoan()" class="btn btn-warning">üí∞ –í–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç</button>
                                <button onclick="repayLoan()" class="btn btn-danger" style="grid-column: span 2;">üí∏ –ü–æ–≥–∞—Å–∏—Ç—å –∫—Ä–µ–¥–∏—Ç (150%)</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== –≠–ö–†–ê–ù –û–†–ì–ê–ù–ò–ó–ê–¢–û–†–ê ========== -->
            <div id="adminScreen" class="screen">
                <div class="header">
                    <div class="logo">
                        <button onclick="logout()" class="btn btn-outline" style="padding:8px 12px;"><i class="fas fa-arrow-left"></i></button>
                        <div class="logo-icon"><i class="fas fa-crown"></i></div>
                        <div class="logo-text">
                            <h1>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</h1>
                            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π</p>
                        </div>
                    </div>
                    <div class="user-info">
                        <span class="impulse-badge"><i class="fas fa-star"></i> –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø</span>
                        <button onclick="refreshAdminData()" class="btn" style="padding:8px;"><i class="fas fa-sync-alt"></i></button>
                    </div>
                </div>

                <div class="dashboard">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchAdminTab('teams')">üë• –ö–æ–º–∞–Ω–¥—ã</button>
                        <button class="tab-btn" onclick="switchAdminTab('shop')">üõí –¢–æ–≤–∞—Ä—ã</button>
                        <button class="tab-btn" onclick="switchAdminTab('events')">üå©Ô∏è –°–æ–±—ã—Ç–∏—è</button>
                        <button class="tab-btn" onclick="switchAdminTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –ö–û–ú–ê–ù–î–´ -->
                    <div id="adminTeamsTab" style="display: block;">
                        <div class="table-container">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:15px;">
                                <h3><i class="fas fa-users"></i> –í—Å–µ –∫–æ–º–∞–Ω–¥—ã</h3>
                                <button onclick="showAddTeamModal()" class="btn btn-success"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                            <table>
                                <thead><tr><th>ID</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>‚ö°</th><th>–ö—É–ø–ª–µ–Ω–æ</th><th>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</th><th>–ö–æ–¥</th><th>–ö–æ–Ω—Ç–∞–∫—Ç</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
                                <tbody id="teamsTableBody"></tbody>
                            </table>
                        </div>

                        <!-- –ë—ã—Å—Ç—Ä–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ -->
                        <div class="stats-grid">
                            <div class="table-container">
                                <h3><i class="fas fa-bolt"></i> –ë—ã—Å—Ç—Ä–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ</h3>
                                <select id="quickTeamSelect" class="form-control" style="margin-bottom:12px;"></select>
                                <div style="display: grid; grid-template-columns: repeat(2,1fr); gap:8px;">
                                    <button onclick="quickAdd(10,'–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å')" class="btn btn-success">+10</button>
                                    <button onclick="quickAdd(20,'–ü–æ–±–µ–¥–∞')" class="btn btn-success">+20</button>
                                    <button onclick="quickAdd(50,'–û—Å–æ–±–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ')" class="btn btn-success">+50</button>
                                    <button onclick="quickAdd(-5,'–ó–∞–º–µ—á–∞–Ω–∏–µ')" class="btn btn-danger">-5</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <h3><i class="fas fa-pen"></i> –†—É—á–Ω–æ–µ</h3>
                                <select id="manualTeamSelect" class="form-control" style="margin-bottom:12px;"></select>
                                <input type="number" id="pointsInput" class="form-control" placeholder="–ò–º–ø—É–ª—å—Å—ã" style="margin-bottom:12px;">
                                <input type="text" id="reasonInput" class="form-control" placeholder="–ü—Ä–∏—á–∏–Ω–∞" style="margin-bottom:12px;">
                                <button onclick="manualAddPoints()" class="btn btn-primary" style="width:100%;">–ù–∞—á–∏—Å–ª–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê–ú–ò -->
                    <div id="adminShopTab" style="display: none;">
                        <div class="table-container">
                            <div style="display: flex; justify-content: space-between; margin-bottom:15px;">
                                <h3><i class="fas fa-boxes"></i> –¢–æ–≤–∞—Ä—ã</h3>
                                <button onclick="showAddItemModal()" class="btn btn-success"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                            <table>
                                <thead><tr><th>ID</th><th>–ò–∫–æ–Ω–∫–∞</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¶–µ–Ω–∞</th><th>–¢–∏–ø</th><th>–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
                                <tbody id="itemsTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –°–û–ë–´–¢–ò–Ø –ò –†–ê–£–ù–î–´ -->
                    <div id="adminEventsTab" style="display: none;">
                        <div class="stats-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="table-container">
                                <h3><i class="fas fa-clock"></i> –†–∞—É–Ω–¥—ã</h3>
                                <p>–ù–∞—á–∏—Å–ª–∏—Ç—å –¥–æ—Ö–æ–¥ –∑–∞ 30 –º–∏–Ω (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—â–∏–µ –∑–¥–∞–Ω–∏—è)</p>
                                <button onclick="processRoundIncome()" class="btn btn-success" style="width:100%;">üöÄ –ù–∞—á–∏—Å–ª–∏—Ç—å –¥–æ—Ö–æ–¥ –∑–∞ —Ä–∞—É–Ω–¥</button>
                            </div>
                            <div class="table-container">
                                <h3><i class="fas fa-bolt"></i> –°–æ–±—ã—Ç–∏—è</h3>
                                <select id="eventSelect" class="form-control" style="margin-bottom:12px;">
                                    <option value="meteor">–ú–µ—Ç–µ–æ—Ä–∏—Ç–Ω—ã–π –¥–æ–∂–¥—å (–Ω–µ—Ç —â–∏—Ç–∞ -20%)</option>
                                    <option value="solarFlare">–°–æ–ª–Ω–µ—á–Ω–∞—è –±—É—Ä—è (—ç–Ω–µ—Ä–≥–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)</option>
                                    <option value="resourceBoost">–†–µ—Å—É—Ä—Å–Ω—ã–π –±—É–º (—à–∞—Ö—Ç—ã +100%)</option>
                                </select>
                                <button onclick="applyEvent()" class="btn btn-primary" style="width:100%;">üå©Ô∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <h3><i class="fas fa-file-contract"></i> –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã</h3>
                            <select id="teamContractSelect" class="form-control" style="margin-bottom:12px;"></select>
                            <button onclick="assignContract()" class="btn btn-info">üìù –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç</button>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
                    <div id="adminStatsTab" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-card"><div class="stat-value" id="totalTeamsStat">0</div><div class="stat-label">–ö–æ–º–∞–Ω–¥</div></div>
                            <div class="stat-card"><div class="stat-value" id="totalImpulsesStat">0</div><div class="stat-label">–í—Å–µ–≥–æ –∏–º–ø—É–ª—å—Å–æ–≤</div></div>
                            <div class="stat-card"><div class="stat-value" id="totalPurchasesStat">0</div><div class="stat-label">–ü–æ–∫—É–ø–æ–∫</div></div>
                        </div>
                        <div class="table-container">
                            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
                            <div id="recentTransactionsAdmin">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ========== -->

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã -->
    <div id="addTeamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞</h2><button class="modal-close" onclick="closeModal('addTeamModal')">&times;</button></div>
            <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="newTeamName" class="form-control"></div>
            <div class="form-group"><label>–ö–æ–¥ (6 —Å–∏–º–≤–æ–ª–æ–≤)</label><input type="text" id="newTeamCode" class="form-control" maxlength="6"></div>
            <div class="form-group"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input type="text" id="newTeamContact" class="form-control"></div>
            <button onclick="addTeam()" class="btn btn-primary" style="width:100%;">–°–æ–∑–¥–∞—Ç—å</button>
        </div>
    </div>

    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã -->
    <div id="editTeamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</h2><button class="modal-close" onclick="closeModal('editTeamModal')">&times;</button></div>
            <input type="hidden" id="editTeamId">
            <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="editTeamName" class="form-control"></div>
            <div class="form-group"><label>–ö–æ–¥</label><input type="text" id="editTeamCode" class="form-control" maxlength="6"></div>
            <div class="form-group"><label>–ö–æ–Ω—Ç–∞–∫—Ç</label><input type="text" id="editTeamContact" class="form-control"></div>
            <div style="display:flex; gap:10px;"><button onclick="updateTeam()" class="btn btn-primary" style="flex:1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button onclick="deleteTeam()" class="btn btn-danger" style="flex:1;">–£–¥–∞–ª–∏—Ç—å</button></div>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
    <div id="addItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>–ù–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ</h2><button class="modal-close" onclick="closeModal('addItemModal')">&times;</button></div>
            <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="newItemName" class="form-control"></div>
            <div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><input type="text" id="newItemDesc" class="form-control"></div>
            <div class="form-group"><label>–¶–µ–Ω–∞</label><input type="number" id="newItemPrice" class="form-control"></div>
            <div class="form-group"><label>–ò–∫–æ–Ω–∫–∞ (Font Awesome)</label><input type="text" id="newItemIcon" class="form-control" value="fa-solid fa-question"></div>
            <div class="form-group"><label>–¢–∏–ø</label><input type="text" id="newItemType" class="form-control" value="–æ–±—â–µ–µ"></div>
            <div class="form-group"><label>–≠—Ñ—Ñ–µ–∫—Ç (JSON)</label><textarea id="newItemEffect" class="form-control" rows="3">{}</textarea></div>
            <div class="form-group"><label><input type="checkbox" id="newItemUnique"> –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ (—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞)</label></div>
            <button onclick="addItem()" class="btn btn-primary" style="width:100%;">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
    <div id="editItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–¥–∞–Ω–∏–µ</h2><button class="modal-close" onclick="closeModal('editItemModal')">&times;</button></div>
            <input type="hidden" id="editItemId">
            <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="editItemName" class="form-control"></div>
            <div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><input type="text" id="editItemDesc" class="form-control"></div>
            <div class="form-group"><label>–¶–µ–Ω–∞</label><input type="number" id="editItemPrice" class="form-control"></div>
            <div class="form-group"><label>–ò–∫–æ–Ω–∫–∞</label><input type="text" id="editItemIcon" class="form-control"></div>
            <div class="form-group"><label>–¢–∏–ø</label><input type="text" id="editItemType" class="form-control"></div>
            <div class="form-group"><label>–≠—Ñ—Ñ–µ–∫—Ç (JSON)</label><textarea id="editItemEffect" class="form-control" rows="3"></textarea></div>
            <div class="form-group"><label><input type="checkbox" id="editItemUnique"> –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ</label></div>
            <div style="display:flex; gap:10px;"><button onclick="updateItem()" class="btn btn-primary" style="flex:1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button onclick="deleteItem()" class="btn btn-danger" style="flex:1;">–£–¥–∞–ª–∏—Ç—å</button></div>
        </div>
    </div>

    <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∫–æ–º–∞–Ω–¥—ã (–¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞) -->
    <div id="inventoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="inventoryTeamName">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∫–æ–º–∞–Ω–¥—ã</h2><button class="modal-close" onclick="closeModal('inventoryModal')">&times;</button></div>
            <div id="inventoryList" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // ================= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =================
        const CONFIG = {
            // !!! –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® URL –û–¢ PUBLISHED APPS SCRIPT !!!
            SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbx_j4vrhLIO_-UORX8kJFYbF7pgGE-taJ66s0Uk4felUak6eKwqETBDEm16maYse06S/exec',
            ADMIN_PASSWORD: 'org2026',
            REFRESH_INTERVAL: 30000
        };

        // ================= –°–û–°–¢–û–Ø–ù–ò–ï =================
        let currentState = {
            team: null,
            isAdmin: false,
            adminPassword: '',
            allTeams: [],
            allItems: [],
            purchases: [],
            transactions: [],
            rating: [],
            contracts: []
        };

        // ================= –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò =================
        function showNotification(message, type = 'info') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = `notification ${type}`;
            notif.style.display = 'block';
            setTimeout(() => { notif.style.display = 'none'; }, 3000);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function logout() {
            currentState.team = null;
            currentState.isAdmin = false;
            currentState.adminPassword = '';
            localStorage.removeItem('team');
            localStorage.removeItem('admin');
            localStorage.removeItem('adminPwd');
            stopAutoRefresh();
            showScreen('loginScreen');
        }

        // ================= –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =================
        document.addEventListener('DOMContentLoaded', () => {
            const savedTeam = localStorage.getItem('team');
            const savedAdmin = localStorage.getItem('admin') === 'true';
            const savedPwd = localStorage.getItem('adminPwd');
            if (savedTeam) {
                currentState.team = JSON.parse(savedTeam);
                showScreen('teamScreen');
                loadTeamData();
                startAutoRefresh();
            } else if (savedAdmin && savedPwd) {
                currentState.isAdmin = true;
                currentState.adminPassword = savedPwd;
                showScreen('adminScreen');
                loadAdminData();
                startAutoRefresh();
            }
        });

        function loginAsTeam() {
            const code = document.getElementById('teamCodeInput').value.trim().toUpperCase();
            if (!code) return showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥', 'error');
            fetch(`${CONFIG.SCRIPT_URL}?action=getTeamByCode&code=${encodeURIComponent(code)}`)
                .then(r => r.json())
                .then(res => {
                    if (res.success && res.data.team) {
                        currentState.team = res.data.team;
                        localStorage.setItem('team', JSON.stringify(currentState.team));
                        showScreen('teamScreen');
                        loadTeamData();
                        startAutoRefresh();
                        showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentState.team.name}!`, 'success');
                    } else {
                        showNotification('–ö–æ–º–∞–Ω–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    }
                })
                .catch(() => showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error'));
        }

        function loginAsAdmin() {
            const pwd = document.getElementById('adminPasswordInput').value;
            if (!pwd) return showNotification('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å', 'error');
            fetch(CONFIG.SCRIPT_URL, {
                method: 'POST',
                body: new URLSearchParams({ action: 'checkPassword', password: pwd })
            })
            .then(r => r.json())
            .then(res => {
                if (res.success && res.data.valid) {
                    currentState.isAdmin = true;
                    currentState.adminPassword = pwd;
                    localStorage.setItem('admin', 'true');
                    localStorage.setItem('adminPwd', pwd);
                    showScreen('adminScreen');
                    loadAdminData();
                    startAutoRefresh();
                    showNotification('–î–æ—Å—Ç—É–ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞', 'success');
                } else {
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
                }
            })
            .catch(() => showNotification('–û—à–∏–±–∫–∞', 'error'));
        }

        // ================= –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ö–û–ú–ê–ù–î–´ =================
        async function loadTeamData() {
            if (!currentState.team) return;
            try {
                const [ratingRes, historyRes, itemsRes, invRes, contractsRes] = await Promise.all([
                    fetch(`${CONFIG.SCRIPT_URL}?action=getRating`),
                    fetch(`${CONFIG.SCRIPT_URL}?action=getTransactions&teamId=${currentState.team.id}`),
                    fetch(`${CONFIG.SCRIPT_URL}?action=getShopItems`),
                    fetch(`${CONFIG.SCRIPT_URL}?action=getTeamInventory&teamId=${currentState.team.id}`),
                    fetch(`${CONFIG.SCRIPT_URL}?action=getContracts`)
                ]);

                const ratingData = await ratingRes.json();
                const historyData = await historyRes.json();
                const itemsData = await itemsRes.json();
                const invData = await invRes.json();
                const contractsData = await contractsRes.json();

                if (ratingData.success) {
                    currentState.rating = ratingData.data.rating || [];
                    const updated = currentState.rating.find(t => t.id == currentState.team.id);
                    if (updated) {
                        currentState.team.score = updated.score || 0;
                        currentState.team.name = updated.name;
                        currentState.team.investments = updated.investments || 0;
                        currentState.team.loan = updated.loan || 0;
                        currentState.team.contractId = updated.contractId;
                        currentState.team.contractDone = updated.contractDone;
                        localStorage.setItem('team', JSON.stringify(currentState.team));
                    }
                }
                if (historyData.success) currentState.transactions = historyData.data.transactions || [];
                if (itemsData.success) currentState.allItems = itemsData.data.items || [];
                if (invData.success) currentState.purchases = invData.data.items || [];
                if (contractsData.success) currentState.contracts = contractsData.data.contracts || [];

                updateTeamUI();
            } catch (e) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
            }
        }

        function updateTeamUI() {
            if (!currentState.team) return;
            // –®–∞–ø–∫–∞
            document.getElementById('teamNameHeader').textContent = currentState.team.name;
            document.getElementById('teamScoreHeader').textContent = currentState.team.score;
            document.getElementById('teamScoreBadge').textContent = currentState.team.score;
            // –î–∞—à–±–æ—Ä–¥
            document.getElementById('myScore').textContent = currentState.team.score;
            const pos = currentState.rating.findIndex(t => t.id == currentState.team.id) + 1;
            document.getElementById('myPosition').textContent = pos > 0 ? pos : '-';
            document.getElementById('totalTeamsCount').textContent = currentState.rating.length;

            // –ö–æ–Ω—Ç—Ä–∞–∫—Ç
            let contractHtml = '';
            if (currentState.team.contractId) {
                const contract = currentState.contracts.find(c => c.id == currentState.team.contractId);
                if (contract) {
                    contractHtml = `<p>${contract.desc}</p><p>–ù–∞–≥—Ä–∞–¥–∞: ${contract.reward} ‚ö°</p>`;
                    if (currentState.team.contractDone) contractHtml += '<p style="color:var(--neon-green)">‚úì –í—ã–ø–æ–ª–Ω–µ–Ω</p>';
                } else {
                    contractHtml = '<p>–ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>';
                }
            } else {
                contractHtml = '<p>–£ –∫–æ–º–∞–Ω–¥—ã –ø–æ–∫–∞ –Ω–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.</p>';
            }
            document.getElementById('contractInfo').innerHTML = contractHtml;

            // –ò—Å—Ç–æ—Ä–∏—è
            let histHtml = '<table><tr><th>–í—Ä–µ–º—è</th><th>–ò–º–ø—É–ª—å—Å—ã</th><th>–ü—Ä–∏—á–∏–Ω–∞</th></tr>';
            if (currentState.transactions.length) {
                currentState.transactions.slice(0,10).forEach(t => {
                    histHtml += `<tr><td>${new Date(t.timestamp).toLocaleString()}</td><td>${t.points>0?'+':''}${t.points}</td><td>${t.reason}</td></tr>`;
                });
            } else histHtml += '<tr><td colspan="3">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏</td></tr>';
            histHtml += '</table>';
            document.getElementById('historyTable').innerHTML = histHtml;

            // –†–µ–π—Ç–∏–Ω–≥
            let rateHtml = '<table><tr><th>–ú–µ—Å—Ç–æ</th><th>–ö–æ–º–∞–Ω–¥–∞</th><th>–ò–º–ø—É–ª—å—Å—ã</th></tr>';
            currentState.rating.slice(0,15).forEach((t,i) => {
                rateHtml += `<tr ${t.id==currentState.team.id?'style="background:rgba(78,84,245,0.3)"':''}><td>${i+1}</td><td>${t.name}</td><td>${t.score}</td></tr>`;
            });
            rateHtml += '</table>';
            document.getElementById('ratingTable').innerHTML = rateHtml;

            // –ú–∞–≥–∞–∑–∏–Ω
            document.getElementById('shopImpulseBalance').textContent = currentState.team.score;
            let shopHtml = '';
            if (currentState.allItems.length) {
                const purchasedIds = currentState.purchases.map(p => p.id);
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –∫–æ–º–∞–Ω–¥—ã –∑–¥–∞–Ω–∏–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–∫—É–ø–ª–µ–Ω–æ"
                const hasBoughtStatus = currentState.purchases.some(p => p.status === '–∫—É–ø–ª–µ–Ω–æ');
                currentState.allItems.forEach(item => {
                    const alreadyOwned = purchasedIds.includes(item.id);
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å "–∫—É–ø–ª–µ–Ω–æ" –ò–õ–ò —É–∂–µ –∫—É–ø–ª–µ–Ω–æ –ò–õ–ò –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
                    const disabled = hasBoughtStatus || alreadyOwned || currentState.team.score < item.price;
                    shopHtml += `
                        <div class="product-card">
                            <div class="product-icon"><i class="${item.icon}"></i></div>
                            <div class="product-name">${item.name}</div>
                            <div class="product-description">${item.description}</div>
                            <div class="product-price"><i class="fas fa-bolt"></i> ${item.price}</div>
                            <button class="btn-buy" onclick="buyItem(${item.id})" ${disabled ? 'disabled' : ''}>
                                ${alreadyOwned ? '–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞' : (hasBoughtStatus ? '–ñ–¥–∏—Ç–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏' : '–ö—É–ø–∏—Ç—å')}
                            </button>
                        </div>
                    `;
                });
            } else shopHtml = '<p>–¢–æ–≤–∞—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>';
            document.getElementById('shopItemsGrid').innerHTML = shopHtml;

            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (—Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –æ—Å–æ–±—ã—Ö –∑–¥–∞–Ω–∏–π)
            let invHtml = '';
            if (currentState.purchases.length) {
                currentState.purchases.forEach(item => {
                    const extraButton = item.status === '—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç' ? getExtraButton(item) : '';
                    invHtml += `
                        <div class="product-card">
                            <div class="product-icon"><i class="${item.icon}"></i></div>
                            <div class="product-name">${item.name}</div>
                            <div class="product-description">${item.description}</div>
                            <div><span class="status-badge ${item.status}">${item.status}</span></div>
                            <div style="margin-top:10px;">${extraButton}</div>
                        </div>
                    `;
                });
            } else invHtml = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –∑–¥–∞–Ω–∏–π.</p>';
            document.getElementById('inventoryGrid').innerHTML = invHtml;

            // –§–∏–Ω–∞–Ω—Å—ã
            document.getElementById('investmentsValue').textContent = currentState.team.investments || 0;
            document.getElementById('loanValue').textContent = currentState.team.loan || 0;
        }

        function getExtraButton(item) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Å–æ–±—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
            if (item.effect.gamble) {
                return `<button class="btn btn-warning btn-sm" onclick="activateVenture(${item.purchaseId})">üé≤ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—Ç–∞–ø</button>`;
            }
            if (item.effect.ability === 'recreation') {
                return `<button class="btn btn-info btn-sm" onclick="activateRecreation(${item.purchaseId})">üèùÔ∏è –û—Ç–¥—ã—Ö</button>`;
            }
            if (item.effect.ability === 'recompute') {
                return `<button class="btn btn-primary btn-sm" onclick="activateQuantum(${item.purchaseId})">‚öõÔ∏è –ö–≤–∞–Ω—Ç–æ–≤—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç</button>`;
            }
            return '';
        }

        // ================= –ü–û–ö–£–ü–ö–ê =================
        async function buyItem(itemId) {
            if (!currentState.team) return;
            try {
                const formData = new FormData();
                formData.append('action', 'buyItem');
                formData.append('teamId', currentState.team.id);
                formData.append('itemId', itemId);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–ó–¥–∞–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –µ–≥–æ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å.', 'success');
                    currentState.team.score = result.data.newScore;
                    localStorage.setItem('team', JSON.stringify(currentState.team));
                    loadTeamData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        // ================= –ê–ö–¢–ò–í–ê–¶–ò–ò =================
        async function activateVenture(purchaseId) {
            if (!confirm('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–µ–Ω—á—É—Ä–Ω—ã–π —Å—Ç–∞—Ä—Ç–∞–ø? –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª—É—á–∞–µ–Ω.')) return;
            try {
                const formData = new FormData();
                formData.append('action', 'activateVenture');
                formData.append('teamId', currentState.team.id);
                formData.append('purchaseId', purchaseId);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification(`–°—Ç–∞—Ä—Ç–∞–ø –ø—Ä–∏–Ω—ë—Å ${result.data.gain} ‚ö°`, 'success');
                    loadTeamData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        async function activateRecreation(purchaseId) {
            if (!confirm('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫—Ä–µ–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å? –ë—É–¥–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω –±–æ–Ω—É—Å –∑–∞ –∂–∏–ª—ã–µ –∑–¥–∞–Ω–∏—è.')) return;
            try {
                const formData = new FormData();
                formData.append('action', 'activateRecreation');
                formData.append('teamId', currentState.team.id);
                formData.append('purchaseId', purchaseId);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification(`–ë–æ–Ω—É—Å: ${result.data.bonus} ‚ö°`, 'success');
                    loadTeamData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        async function activateQuantum(purchaseId) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        // ================= –§–ò–ù–ê–ù–°–´ =================
        async function investInFund() {
            const amount = prompt('–°—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ (–º–∏–Ω–∏–º—É–º 5):', '5');
            if (!amount) return;
            const num = parseInt(amount);
            if (num < 5) return showNotification('–ú–∏–Ω–∏–º—É–º 5', 'warning');
            try {
                const formData = new FormData();
                formData.append('action', 'investInFund');
                formData.append('teamId', currentState.team.id);
                formData.append('amount', num);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification(`–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ ${num} ‚ö°`, 'success');
                    loadTeamData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        async function takeLoan() {
            const amount = prompt('–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ (1-10):', '5');
            if (!amount) return;
            const num = parseInt(amount);
            if (num < 1 || num > 10) return showNotification('–û—Ç 1 –¥–æ 10', 'warning');
            try {
                const formData = new FormData();
                formData.append('action', 'takeLoan');
                formData.append('teamId', currentState.team.id);
                formData.append('amount', num);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification(`–ö—Ä–µ–¥–∏—Ç ${num} –ø–æ–ª—É—á–µ–Ω`, 'success');
                    loadTeamData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        async function repayLoan() {
            if (!confirm('–ü–æ–≥–∞—Å–∏—Ç—å –∫—Ä–µ–¥–∏—Ç —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º 1.5?')) return;
            try {
                const formData = new FormData();
                formData.append('action', 'repayLoan');
                formData.append('teamId', currentState.team.id);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–ö—Ä–µ–¥–∏—Ç –ø–æ–≥–∞—à–µ–Ω', 'success');
                    loadTeamData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        // ================= –ö–û–ù–¢–†–ê–ö–¢ =================
        async function checkContract() {
            try {
                const formData = new FormData();
                formData.append('action', 'checkContract');
                formData.append('teamId', currentState.team.id);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification(`–ö–æ–Ω—Ç—Ä–∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! –ü–æ–ª—É—á–µ–Ω–æ ${result.data.reward} ‚ö°`, 'success');
                    loadTeamData();
                } else {
                    showNotification(result.data.message || '–ö–æ–Ω—Ç—Ä–∞–∫—Ç –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'info');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        // ================= –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –¢–ê–ë–û–í –£–ß–ê–°–¢–ù–ò–ö–ê =================
        window.switchTeamTab = (tab) => {
            document.querySelectorAll('#teamScreen .tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('teamDashboardTab').style.display = tab === 'dashboard' ? 'block' : 'none';
            document.getElementById('teamShopTab').style.display = tab === 'shop' ? 'block' : 'none';
            document.getElementById('teamInventoryTab').style.display = tab === 'inventory' ? 'block' : 'none';
            document.getElementById('teamFinanceTab').style.display = tab === 'finance' ? 'block' : 'none';
            if (tab !== 'dashboard') loadTeamData();
        };

        // ================= –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –û–†–ì–ê–ù–ò–ó–ê–¢–û–†–ê =================
        async function loadAdminData() {
            try {
                const [teamsRes, itemsRes, transRes] = await Promise.all([
                    fetch(`${CONFIG.SCRIPT_URL}?action=getTeams`),
                    fetch(`${CONFIG.SCRIPT_URL}?action=getShopItems`),
                    fetch(`${CONFIG.SCRIPT_URL}?action=getTransactions`)
                ]);
                const teamsData = await teamsRes.json();
                const itemsData = await itemsRes.json();
                const transData = await transRes.json();

                if (teamsData.success) currentState.allTeams = teamsData.data.teams || [];
                if (itemsData.success) currentState.allItems = itemsData.data.items || [];
                if (transData.success) currentState.transactions = transData.data.transactions || [];

                updateAdminUI();
            } catch (e) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
            }
        }

        function updateAdminUI() {
            // –ö–æ–º–∞–Ω–¥—ã
            let teamsHtml = '';
            if (currentState.allTeams.length) {
                currentState.allTeams.forEach(t => {
                    teamsHtml += `<tr>
                        <td>${t.id}</td>
                        <td>${t.name}</td>
                        <td>${t.score}</td>
                        <td>${t.purchasedCount || 0}</td>
                        <td>${t.totalSpent || 0}</td>
                        <td>${t.code}</td>
                        <td>${t.contact || '-'}</td>
                        <td>
                            <button class="btn btn-primary btn-icon" onclick="openEditTeamModal(${t.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-info btn-icon" onclick="showTeamInventory(${t.id})" title="–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å"><i class="fas fa-box"></i></button>
                        </td>
                    </tr>`;
                });
            } else teamsHtml = '<tr><td colspan="8">–ù–µ—Ç –∫–æ–º–∞–Ω–¥</td></tr>';
            document.getElementById('teamsTableBody').innerHTML = teamsHtml;

            // –°–µ–ª–µ–∫—Ç—ã
            let options = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É</option>';
            currentState.allTeams.forEach(t => options += `<option value="${t.id}">${t.name} (${t.score} ‚ö°)</option>`);
            document.getElementById('quickTeamSelect').innerHTML = options;
            document.getElementById('manualTeamSelect').innerHTML = options;
            document.getElementById('teamContractSelect').innerHTML = options;

            // –¢–æ–≤–∞—Ä—ã
            let itemsHtml = '';
            if (currentState.allItems.length) {
                currentState.allItems.forEach(i => {
                    itemsHtml += `<tr>
                        <td>${i.id}</td>
                        <td><i class="${i.icon}"></i></td>
                        <td>${i.name}</td>
                        <td>${i.price}</td>
                        <td>${i.type}</td>
                        <td>${i.unique ? '–î–∞' : '–ù–µ—Ç'}</td>
                        <td>
                            <button class="btn btn-primary btn-icon" onclick="openEditItemModal(${i.id})"><i class="fas fa-edit"></i></button>
                        </td>
                    </tr>`;
                });
            } else itemsHtml = '<tr><td colspan="7">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</td></tr>';
            document.getElementById('itemsTableBody').innerHTML = itemsHtml;

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('totalTeamsStat').textContent = currentState.allTeams.length;
            const totalImp = currentState.allTeams.reduce((acc, t) => acc + (t.score || 0), 0);
            document.getElementById('totalImpulsesStat').textContent = totalImp;
            const totalPurchases = currentState.allTeams.reduce((acc, t) => acc + (t.purchasedCount || 0), 0);
            document.getElementById('totalPurchasesStat').textContent = totalPurchases;

            // –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            let transHtml = '<table><tr><th>–í—Ä–µ–º—è</th><th>–ö–æ–º–∞–Ω–¥–∞</th><th>–ò–º–ø—É–ª—å—Å—ã</th><th>–ü—Ä–∏—á–∏–Ω–∞</th></tr>';
            if (currentState.transactions.length) {
                currentState.transactions.slice(0,10).forEach(t => {
                    const team = currentState.allTeams.find(tt => tt.id == t.teamId);
                    transHtml += `<tr><td>${new Date(t.timestamp).toLocaleString()}</td><td>${team ? team.name : t.teamId}</td><td>${t.points}</td><td>${t.reason}</td></tr>`;
                });
            } else transHtml += '<tr><td colspan="4">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</td></tr>';
            transHtml += '</table>';
            document.getElementById('recentTransactionsAdmin').innerHTML = transHtml;
        }

        // ================= –û–†–ì–ê–ù–ò–ó–ê–¢–û–†: –î–ï–ô–°–¢–í–ò–Ø =================
        function quickAdd(points, reason) {
            const teamId = document.getElementById('quickTeamSelect').value;
            if (!teamId) return showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É', 'warning');
            document.getElementById('manualTeamSelect').value = teamId;
            document.getElementById('pointsInput').value = points;
            document.getElementById('reasonInput').value = reason;
            manualAddPoints();
        }

        async function manualAddPoints() {
            const teamId = document.getElementById('manualTeamSelect').value;
            const points = parseInt(document.getElementById('pointsInput').value);
            const reason = document.getElementById('reasonInput').value.trim();
            if (!teamId || isNaN(points) || !reason) return showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');

            const formData = new FormData();
            formData.append('action', 'addPoints');
            formData.append('teamId', teamId);
            formData.append('points', points);
            formData.append('reason', reason);
            formData.append('moderator', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä');
            formData.append('password', currentState.adminPassword);

            try {
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–ù–∞—á–∏—Å–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ', 'success');
                    document.getElementById('pointsInput').value = '';
                    document.getElementById('reasonInput').value = '';
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        // CRUD –∫–æ–º–∞–Ω–¥
        function showAddTeamModal() { document.getElementById('addTeamModal').classList.add('active'); }
        async function addTeam() {
            const name = document.getElementById('newTeamName').value.trim();
            const code = document.getElementById('newTeamCode').value.trim().toUpperCase();
            const contact = document.getElementById('newTeamContact').value.trim();
            if (!name || !code) return showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–æ–¥', 'error');
            if (code.length !== 6) return showNotification('–ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
            const formData = new FormData();
            formData.append('action', 'addTeam');
            formData.append('name', name);
            formData.append('code', code);
            formData.append('contact', contact);
            formData.append('password', currentState.adminPassword);
            try {
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–ö–æ–º–∞–Ω–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
                    closeModal('addTeamModal');
                    document.getElementById('newTeamName').value = '';
                    document.getElementById('newTeamCode').value = '';
                    document.getElementById('newTeamContact').value = '';
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞', 'error'); }
        }

        function openEditTeamModal(id) {
            const team = currentState.allTeams.find(t => t.id == id);
            if (team) {
                document.getElementById('editTeamId').value = team.id;
                document.getElementById('editTeamName').value = team.name;
                document.getElementById('editTeamCode').value = team.code;
                document.getElementById('editTeamContact').value = team.contact || '';
                document.getElementById('editTeamModal').classList.add('active');
            }
        }
        async function updateTeam() {
            const id = document.getElementById('editTeamId').value;
            const name = document.getElementById('editTeamName').value.trim();
            const code = document.getElementById('editTeamCode').value.trim().toUpperCase();
            const contact = document.getElementById('editTeamContact').value.trim();
            if (!name || !code) return showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è', 'error');
            const formData = new FormData();
            formData.append('action', 'updateTeam');
            formData.append('teamId', id);
            formData.append('name', name);
            formData.append('code', code);
            formData.append('contact', contact);
            formData.append('password', currentState.adminPassword);
            try {
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–û–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                    closeModal('editTeamModal');
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞', 'error'); }
        }
        async function deleteTeam() {
            const id = document.getElementById('editTeamId').value;
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É?')) return;
            const formData = new FormData();
            formData.append('action', 'deleteTeam');
            formData.append('teamId', id);
            formData.append('password', currentState.adminPassword);
            try {
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–ö–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
                    closeModal('editTeamModal');
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞', 'error'); }
        }

        // CRUD —Ç–æ–≤–∞—Ä–æ–≤
        function showAddItemModal() { document.getElementById('addItemModal').classList.add('active'); }
        async function addItem() {
            const name = document.getElementById('newItemName').value.trim();
            const desc = document.getElementById('newItemDesc').value.trim();
            const price = parseInt(document.getElementById('newItemPrice').value);
            const icon = document.getElementById('newItemIcon').value.trim();
            const type = document.getElementById('newItemType').value.trim();
            const effect = document.getElementById('newItemEffect').value;
            const unique = document.getElementById('newItemUnique').checked;
            if (!name || !price) return showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É', 'error');
            try { JSON.parse(effect); } catch { return showNotification('–≠—Ñ—Ñ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º JSON', 'error'); }
            const formData = new FormData();
            formData.append('action', 'addItem');
            formData.append('name', name);
            formData.append('description', desc);
            formData.append('price', price);
            formData.append('icon', icon);
            formData.append('type', type);
            formData.append('effect', effect);
            formData.append('unique', unique);
            formData.append('password', currentState.adminPassword);
            try {
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                    closeModal('addItemModal');
                    document.getElementById('newItemName').value = '';
                    document.getElementById('newItemDesc').value = '';
                    document.getElementById('newItemPrice').value = '';
                    document.getElementById('newItemIcon').value = 'fa-solid fa-question';
                    document.getElementById('newItemType').value = '–æ–±—â–µ–µ';
                    document.getElementById('newItemEffect').value = '{}';
                    document.getElementById('newItemUnique').checked = false;
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞', 'error'); }
        }

        function openEditItemModal(id) {
            const item = currentState.allItems.find(i => i.id == id);
            if (item) {
                document.getElementById('editItemId').value = item.id;
                document.getElementById('editItemName').value = item.name;
                document.getElementById('editItemDesc').value = item.description;
                document.getElementById('editItemPrice').value = item.price;
                document.getElementById('editItemIcon').value = item.icon;
                document.getElementById('editItemType').value = item.type;
                document.getElementById('editItemEffect').value = JSON.stringify(item.effect);
                document.getElementById('editItemUnique').checked = item.unique;
                document.getElementById('editItemModal').classList.add('active');
            }
        }
        async function updateItem() {
            const id = document.getElementById('editItemId').value;
            const name = document.getElementById('editItemName').value.trim();
            const desc = document.getElementById('editItemDesc').value.trim();
            const price = parseInt(document.getElementById('editItemPrice').value);
            const icon = document.getElementById('editItemIcon').value.trim();
            const type = document.getElementById('editItemType').value.trim();
            const effect = document.getElementById('editItemEffect').value;
            const unique = document.getElementById('editItemUnique').checked;
            if (!name || !price) return showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è', 'error');
            try { JSON.parse(effect); } catch { return showNotification('–≠—Ñ—Ñ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º JSON', 'error'); }
            const formData = new FormData();
            formData.append('action', 'updateItem');
            formData.append('itemId', id);
            formData.append('name', name);
            formData.append('description', desc);
            formData.append('price', price);
            formData.append('icon', icon);
            formData.append('type', type);
            formData.append('effect', effect);
            formData.append('unique', unique);
            formData.append('password', currentState.adminPassword);
            try {
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–û–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                    closeModal('editItemModal');
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞', 'error'); }
        }
        async function deleteItem() {
            const id = document.getElementById('editItemId').value;
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) return;
            const formData = new FormData();
            formData.append('action', 'deleteItem');
            formData.append('itemId', id);
            formData.append('password', currentState.adminPassword);
            try {
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω', 'success');
                    closeModal('editItemModal');
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞', 'error'); }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞
        async function showTeamInventory(teamId) {
            const team = currentState.allTeams.find(t => t.id == teamId);
            if (!team) return;
            document.getElementById('inventoryTeamName').textContent = `–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ${team.name}`;
            document.getElementById('inventoryList').innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            document.getElementById('inventoryModal').classList.add('active');

            try {
                const res = await fetch(`${CONFIG.SCRIPT_URL}?action=getTeamInventory&teamId=${teamId}`);
                const data = await res.json();
                if (data.success && data.data.items) {
                    const items = data.data.items;
                    let html = '<ul class="inventory-list">';
                    if (items.length) {
                        items.forEach(item => {
                            let actions = '';
                            if (item.status === '—Å—Ç—Ä–æ–∏—Ç—Å—è') {
                                actions = `<button class="btn btn-success btn-icon" onclick="updatePurchaseStatus(${item.purchaseId}, '—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç')" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ"><i class="fas fa-check"></i></button>`;
                            } else if (item.status === '–∫—É–ø–ª–µ–Ω–æ') {
                                actions = `<button class="btn btn-warning btn-icon" onclick="updatePurchaseStatus(${item.purchaseId}, '—Å—Ç—Ä–æ–∏—Ç—Å—è')" title="–ù–∞—á–∞—Ç—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ"><i class="fas fa-play"></i></button>`;
                            }
                            html += `<li class="inventory-item">
                                <i class="${item.icon}"></i>
                                <div><strong>${item.name}</strong> ‚Äî ${item.description}</div>
                                <div><span class="status-badge ${item.status}">${item.status}</span></div>
                                <div>${actions}</div>
                            </li>`;
                        });
                    } else {
                        html += '<li>–ù–µ—Ç –∑–¥–∞–Ω–∏–π</li>';
                    }
                    html += '</ul>';
                    document.getElementById('inventoryList').innerHTML = html;
                } else {
                    document.getElementById('inventoryList').innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                }
            } catch (e) {
                document.getElementById('inventoryList').innerHTML = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏';
                showNotification('–û—à–∏–±–∫–∞', 'error');
            }
        }

        async function updatePurchaseStatus(purchaseId, newStatus) {
            if (!confirm(`–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –∑–¥–∞–Ω–∏–µ –≤ —Å—Ç–∞—Ç—É—Å "${newStatus}"?`)) return;
            try {
                const formData = new FormData();
                formData.append('action', 'updatePurchaseStatus');
                formData.append('purchaseId', purchaseId);
                formData.append('status', newStatus);
                formData.append('password', currentState.adminPassword);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—ë–Ω', 'success');
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å (–µ—Å–ª–∏ –º–æ–¥–∞–ª–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞)
                    const teamName = document.getElementById('inventoryTeamName').textContent;
                    const team = currentState.allTeams.find(t => teamName.includes(t.name));
                    if (team) {
                        closeModal('inventoryModal');
                        showTeamInventory(team.id);
                    }
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        // –°–æ–±—ã—Ç–∏—è
        async function processRoundIncome() {
            if (!confirm('–ù–∞—á–∏—Å–ª–∏—Ç—å –¥–æ—Ö–æ–¥ –∑–∞ —Ä–∞—É–Ω–¥ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º?')) return;
            try {
                const formData = new FormData();
                formData.append('action', 'processRoundIncome');
                formData.append('password', currentState.adminPassword);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–î–æ—Ö–æ–¥ –Ω–∞—á–∏—Å–ª–µ–Ω', 'success');
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        async function applyEvent() {
            const eventType = document.getElementById('eventSelect').value;
            if (!eventType) return showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏–µ', 'warning');
            if (!confirm(`–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ "${eventType}"?`)) return;
            try {
                const formData = new FormData();
                formData.append('action', 'applyEvent');
                formData.append('eventType', eventType);
                formData.append('password', currentState.adminPassword);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–°–æ–±—ã—Ç–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ', 'success');
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        async function assignContract() {
            const teamId = document.getElementById('teamContractSelect').value;
            if (!teamId) return showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É', 'warning');
            try {
                const formData = new FormData();
                formData.append('action', 'assignContract');
                formData.append('teamId', teamId);
                formData.append('password', currentState.adminPassword);
                const res = await fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData });
                const result = await res.json();
                if (result.success) {
                    showNotification('–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω', 'success');
                    loadAdminData();
                } else {
                    showNotification(result.data.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (e) { showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error'); }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞
        window.switchAdminTab = (tab) => {
            document.querySelectorAll('#adminScreen .tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('adminTeamsTab').style.display = tab === 'teams' ? 'block' : 'none';
            document.getElementById('adminShopTab').style.display = tab === 'shop' ? 'block' : 'none';
            document.getElementById('adminEventsTab').style.display = tab === 'events' ? 'block' : 'none';
            document.getElementById('adminStatsTab').style.display = tab === 'stats' ? 'block' : 'none';
            if (tab !== 'teams') loadAdminData();
        };

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        let refreshInterval;
        function startAutoRefresh() {
            stopAutoRefresh();
            refreshInterval = setInterval(() => {
                if (currentState.team) loadTeamData();
                else if (currentState.isAdmin) loadAdminData();
            }, CONFIG.REFRESH_INTERVAL);
        }
        function stopAutoRefresh() { if (refreshInterval) clearInterval(refreshInterval); }

        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è onclick
        window.refreshTeamData = loadTeamData;
        window.refreshAdminData = loadAdminData;
    </script>
</body>
</html>



