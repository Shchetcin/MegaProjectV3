<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–≤–µ—Å—Ç 2026 - –û—á–Ω—ã–π —ç—Ç–∞–ø</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .app {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            min-height: 90vh;
        }

        .screen {
            display: none;
            padding: 20px;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 32px;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .login-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 40px;
        }

        .login-card {
            background: var(--light);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .login-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .login-card i {
            font-size: 64px;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .login-card h2 {
            margin-bottom: 20px;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .dashboard {
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border-left: 5px solid var(--primary);
        }

        .stat-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--light);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #ddd;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9ff;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        @media (max-width: 768px) {
            .login-options {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                padding: 10px;
            }
            
            th, td {
                padding: 10px;
                font-size: 14px;
            }
        }

        .loader {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app">
            <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
            <div id="loginScreen" class="screen active">
                <div class="header">
                    <div class="logo">
                        <i class="fas fa-trophy"></i>
                        <h1>–ö–≤–µ—Å—Ç 2026 - –û—á–Ω—ã–π —ç—Ç–∞–ø</h1>
                    </div>
                    <div class="version">v2.0</div>
                </div>
                
                <div class="login-options">
                    <div class="login-card">
                        <i class="fas fa-users"></i>
                        <h2>–£—á–∞—Å—Ç–Ω–∏–∫</h2>
                        <p>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –±–∞–ª–ª—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥</p>
                        <div class="form-group">
                            <input type="text" id="teamCode" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–∞–Ω–¥—ã" maxlength="6">
                        </div>
                        <button onclick="loginAsTeam()" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏ –∫–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫
                        </button>
                    </div>
                    
                    <div class="login-card">
                        <i class="fas fa-user-shield"></i>
                        <h2>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</h2>
                        <p>–í–æ–π–¥–∏—Ç–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–ª–∞–º–∏ –∫–æ–º–∞–Ω–¥</p>
                        <div class="form-group">
                            <input type="password" id="adminPassword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        </div>
                        <button onclick="loginAsAdmin()" class="btn btn-success">
                            <i class="fas fa-lock"></i> –í–æ–π—Ç–∏ –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä
                        </button>
                    </div>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω —É—á–∞—Å—Ç–Ω–∏–∫–∞ -->
            <div id="teamScreen" class="screen">
                <div class="header">
                    <div class="logo">
                        <button onclick="logout()" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                        </button>
                        <h1 id="teamNameDisplay">–ú–æ—è –∫–æ–º–∞–Ω–¥–∞</h1>
                    </div>
                    <div class="user-info">
                        <span id="teamScoreDisplay">0 –±–∞–ª–ª–æ–≤</span>
                        <button onclick="refreshData()" class="btn btn-primary">
                            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <div class="dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">–í–∞—à–∏ –±–∞–ª–ª—ã</div>
                            <div class="stat-value" id="myScore">0</div>
                            <div class="stat-label">–¢–µ–∫—É—â–∏–π —Å—á–µ—Ç</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-label">–í–∞—à–µ –º–µ—Å—Ç–æ</div>
                            <div class="stat-value" id="myPosition">-</div>
                            <div class="stat-label">–í –æ–±—â–µ–º —Ä–µ–π—Ç–∏–Ω–≥–µ</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-label">–í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥</div>
                            <div class="stat-value" id="totalTeams">0</div>
                            <div class="stat-label">–£—á–∞—Å—Ç–≤—É—é—Ç</div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <h3><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</h3>
                        <div id="historyTable">
                            <div class="empty-state">
                                <i class="fas fa-history"></i>
                                <p>–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –ø–æ–∫–∞ –ø—É—Å—Ç–∞</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <h3><i class="fas fa-trophy"></i> –û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥</h3>
                        <div id="ratingTable">
                            <div class="empty-state">
                                <i class="fas fa-trophy"></i>
                                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –≠–∫—Ä–∞–Ω –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ -->
            <div id="adminScreen" class="screen">
                <div class="header">
                    <div class="logo">
                        <button onclick="logout()" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                        </button>
                        <h1>–ü–∞–Ω–µ–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞</h1>
                    </div>
                    <div class="user-info">
                        <span>–†–µ–∂–∏–º: <strong>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</strong></span>
                        <button onclick="refreshData()" class="btn btn-primary">
                            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <div class="dashboard">
                    <div class="table-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3><i class="fas fa-users"></i> –í—Å–µ –∫–æ–º–∞–Ω–¥—ã</h3>
                            <button onclick="showAddTeamModal()" class="btn btn-success">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
                            </button>
                        </div>
                        
                        <table id="allTeamsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ë–∞–ª–ª—ã</th>
                                    <th>–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="teamsTableBody">
                                <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="table-container">
                            <h3><i class="fas fa-plus-circle"></i> –ë—ã—Å—Ç—Ä–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ</h3>
                            <div style="margin-bottom: 20px;">
                                <select id="quickTeamSelect" class="form-control" style="margin-bottom: 10px;">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É</option>
                                </select>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px;">
                                <button onclick="quickAddPoints(10, '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å')" class="btn btn-success">+10 –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                                <button onclick="quickAddPoints(20, '–ü–æ–±–µ–¥–∞ –≤ –∏–≥—Ä–µ')" class="btn btn-success">+20 –ü–æ–±–µ–¥–∞</button>
                                <button onclick="quickAddPoints(30, '–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥')" class="btn btn-success">+30 –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</button>
                                <button onclick="quickAddPoints(50, '–û—Å–æ–±–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ')" class="btn btn-success">+50 –û—Å–æ–±–æ–µ</button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                                <button onclick="quickAddPoints(-5, '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª')" class="btn btn-danger">-5 –ù–∞—Ä—É—à–µ–Ω–∏–µ</button>
                                <button onclick="quickAddPoints(-10, '–û–ø–æ–∑–¥–∞–Ω–∏–µ')" class="btn btn-danger">-10 –û–ø–æ–∑–¥–∞–Ω–∏–µ</button>
                                <button onclick="quickAddPoints(-20, '–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞')" class="btn btn-danger">-20 –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <h3><i class="fas fa-edit"></i> –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ</h3>
                            <div class="form-group">
                                <select id="manualTeamSelect" class="form-control">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="number" id="pointsInput" class="form-control" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤">
                            </div>
                            <div class="form-group">
                                <input type="text" id="reasonInput" class="form-control" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è">
                            </div>
                            <div class="form-group">
                                <input type="text" id="moderatorInput" class="form-control" placeholder="–í–∞—à–µ –∏–º—è">
                            </div>
                            <button onclick="manualAddPoints()" class="btn btn-primary">
                                <i class="fas fa-check"></i> –ù–∞—á–∏—Å–ª–∏—Ç—å –±–∞–ª–ª—ã
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <h3><i class="fas fa-chart-line"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–ö–æ–º–∞–Ω–¥–∞</th>
                                    <th>–ë–∞–ª–ª—ã</th>
                                    <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                                    <th>–ö—Ç–æ</th>
                                </tr>
                            </thead>
                            <tbody id="recentTransactions">
                                <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã -->
    <div id="addTeamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É</h2>
                <button onclick="closeModal('addTeamModal')" class="modal-close">&times;</button>
            </div>
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</label>
                <input type="text" id="newTeamName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã">
            </div>
            <div class="form-group">
                <label>–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞ (6 —Å–∏–º–≤–æ–ª–æ–≤)</label>
                <input type="text" id="newTeamCode" class="form-control" placeholder="ABC123" maxlength="6">
            </div>
            <div class="form-group">
                <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <input type="text" id="newTeamContact" class="form-control" placeholder="–ò–º—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è">
            </div>
            <button onclick="addNewTeam()" class="btn btn-success">
                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
            </button>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notification" class="notification"></div>

    <script>
        // ================= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =================
        const CONFIG = {
            SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbxyLEDIDe_W3iAEwf4BqTHVbDmUO1uwuKr_dtaudrsN97i4sRnoYLTX8BAJO4xfeFWi5A/exec', // –í—Å—Ç–∞–≤—å—Ç–µ URL –≤–∞—à–µ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Google Apps Script
            REFRESH_INTERVAL: 10000, // 10 —Å–µ–∫—É–Ω–¥
            VERSION: '2.0'
        };

        // ================= –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø =================
        let currentState = {
            team: null,
            isAdmin: false,
            allTeams: [],
            rating: [],
            transactions: []
        };

        // ================= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =================
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
            const savedTeam = localStorage.getItem('currentTeam');
            const savedAdmin = localStorage.getItem('isAdmin');
            
            if (savedTeam) {
                currentState.team = JSON.parse(savedTeam);
                showScreen('teamScreen');
                loadTeamData();
                startAutoRefresh();
            } else if (savedAdmin === 'true') {
                currentState.isAdmin = true;
                showScreen('adminScreen');
                loadAdminData();
                startAutoRefresh();
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ SCRIPT_URL
            if (!CONFIG.SCRIPT_URL) {
                showNotification('–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω URL —Å–∫—Ä–∏–ø—Ç–∞. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.', 'error');
            }
        });

        // ================= –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =================
        async function loginAsTeam() {
            const code = document.getElementById('teamCode').value.trim().toUpperCase();
            
            if (!code) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–∞–Ω–¥—ã', 'error');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch(`${CONFIG.SCRIPT_URL}?action=getTeamByCode&code=${code}`);
                const result = await response.json();
                
                if (result.success) {
                    currentState.team = result.data.team;
                    localStorage.setItem('currentTeam', JSON.stringify(currentState.team));
                    showScreen('teamScreen');
                    loadTeamData();
                    startAutoRefresh();
                    showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentState.team.name}!`, 'success');
                } else {
                    showNotification('–ö–æ–º–∞–Ω–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥.', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                console.error('–û—à–∏–±–∫–∞:', error);
            } finally {
                hideLoading();
            }
        }

        async function loginAsAdmin() {
            const password = document.getElementById('adminPassword').value;
            
            if (!password) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch(CONFIG.SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'checkPassword',
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (result.success && result.data.valid) {
                    currentState.isAdmin = true;
                    localStorage.setItem('isAdmin', 'true');
                    showScreen('adminScreen');
                    loadAdminData();
                    startAutoRefresh();
                    showNotification('–ü–∞–Ω–µ–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞', 'success');
                } else {
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
                console.error('–û—à–∏–±–∫–∞:', error);
            } finally {
                hideLoading();
            }
        }

        function logout() {
            currentState.team = null;
            currentState.isAdmin = false;
            localStorage.removeItem('currentTeam');
            localStorage.removeItem('isAdmin');
            stopAutoRefresh();
            showScreen('loginScreen');
            document.getElementById('teamCode').value = '';
            document.getElementById('adminPassword').value = '';
        }

        // ================= –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• =================
        async function loadTeamData() {
            if (!currentState.team) return;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥
                const ratingResponse = await fetch(`${CONFIG.SCRIPT_URL}?action=getRating`);
                const ratingResult = await ratingResponse.json();
                
                if (ratingResult.success) {
                    currentState.rating = ratingResult.data.rating;
                    updateTeamDashboard();
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                const historyResponse = await fetch(`${CONFIG.SCRIPT_URL}?action=getTransactions&teamId=${currentState.team.id}`);
                const historyResult = await historyResponse.json();
                
                if (historyResult.success) {
                    currentState.transactions = historyResult.data.transactions;
                    updateHistoryTable();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        async function loadAdminData() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
                const teamsResponse = await fetch(`${CONFIG.SCRIPT_URL}?action=getTeams`);
                const teamsResult = await teamsResponse.json();
                
                if (teamsResult.success) {
                    currentState.allTeams = teamsResult.data.teams;
                    updateAdminTables();
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                const transResponse = await fetch(`${CONFIG.SCRIPT_URL}?action=getTransactions`);
                const transResult = await transResponse.json();
                
                if (transResult.success) {
                    updateRecentTransactions(transResult.data.transactions);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // ================= –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê =================
        function updateTeamDashboard() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('teamNameDisplay').textContent = currentState.team.name;
            document.getElementById('teamScoreDisplay').textContent = `${currentState.team.score} –±–∞–ª–ª–æ–≤`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('myScore').textContent = currentState.team.score;
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
            const position = currentState.rating.findIndex(team => team.id === currentState.team.id) + 1;
            document.getElementById('myPosition').textContent = position;
            document.getElementById('totalTeams').textContent = currentState.rating.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–π—Ç–∏–Ω–≥–∞
            updateRatingTable();
        }

        function updateHistoryTable() {
            const container = document.getElementById('historyTable');
            
            if (!currentState.transactions || currentState.transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –ø–æ–∫–∞ –ø—É—Å—Ç–∞</p>
                    </div>
                `;
                return;
            }
            
            let html = '<table><thead><tr><th>–í—Ä–µ–º—è</th><th>–ë–∞–ª–ª—ã</th><th>–ü—Ä–∏—á–∏–Ω–∞</th><th>–ö—Ç–æ –Ω–∞—á–∏—Å–ª–∏–ª</th></tr></thead><tbody>';
            
            currentState.transactions.slice(0, 10).forEach(trans => {
                const time = new Date(trans.timestamp).toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const pointsClass = trans.points > 0 ? 'badge-success' : 'badge-danger';
                
                html += `
                    <tr>
                        <td>${time}</td>
                        <td><span class="badge ${pointsClass}">${trans.points > 0 ? '+' : ''}${trans.points}</span></td>
                        <td>${trans.reason || ''}</td>
                        <td>${trans.moderator || ''}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateRatingTable() {
            const container = document.getElementById('ratingTable');
            
            if (!currentState.rating || currentState.rating.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-trophy"></i>
                        <p>–†–µ–π—Ç–∏–Ω–≥ –ø–æ–∫–∞ –ø—É—Å—Ç</p>
                    </div>
                `;
                return;
            }
            
            let html = '<table><thead><tr><th>–ú–µ—Å—Ç–æ</th><th>–ö–æ–º–∞–Ω–¥–∞</th><th>–ë–∞–ª–ª—ã</th><th>–û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ</th></tr></thead><tbody>';
            
            currentState.rating.forEach((team, index) => {
                const isCurrent = currentState.team && team.id === currentState.team.id;
                const rowClass = isCurrent ? 'style="background-color: #e3f2fd;"' : '';
                const medal = index < 3 ? ['ü•á', 'ü•à', 'ü•â'][index] : `${index + 1}.`;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –æ—Ç –ª–∏–¥–µ—Ä–∞
                const leaderScore = currentState.rating[0].score;
                const gap = leaderScore - team.score;
                
                html += `
                    <tr ${rowClass}>
                        <td><strong>${medal}</strong></td>
                        <td>${team.name} ${isCurrent ? '<span class="badge badge-warning">–í—ã</span>' : ''}</td>
                        <td><strong>${team.score}</strong></td>
                        <td>${gap > 0 ? `-${gap}` : '–õ–∏–¥–µ—Ä'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateAdminTables() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
            const tbody = document.getElementById('teamsTableBody');
            const quickSelect = document.getElementById('quickTeamSelect');
            const manualSelect = document.getElementById('manualTeamSelect');
            
            tbody.innerHTML = '';
            quickSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É</option>';
            manualSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É</option>';
            
            currentState.allTeams.forEach(team => {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${team.id}</td>
                    <td><strong>${team.name}</strong></td>
                    <td><span class="badge ${team.score >= 100 ? 'badge-success' : 'badge-warning'}">${team.score}</span></td>
                    <td><code>${team.code}</code></td>
                    <td>
                        <button onclick="editTeam(${team.id})" class="btn btn-primary" style="padding: 5px 10px; margin-right: 5px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="addPointsToTeam(${team.id})" class="btn btn-success" style="padding: 5px 10px;">
                            <i class="fas fa-plus"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏
                const option = `<option value="${team.id}">${team.name} (${team.score} –±–∞–ª–ª–æ–≤)</option>`;
                quickSelect.innerHTML += option;
                manualSelect.innerHTML += option;
            });
        }

        function updateRecentTransactions(transactions) {
            const tbody = document.getElementById('recentTransactions');
            
            if (!transactions || transactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</td></tr>';
                return;
            }
            
            let html = '';
            
            transactions.slice(0, 10).forEach(trans => {
                const time = new Date(trans.timestamp).toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const team = currentState.allTeams.find(t => t.id == trans.teamId);
                const teamName = team ? team.name : `ID: ${trans.teamId}`;
                
                html += `
                    <tr>
                        <td>${time}</td>
                        <td>${teamName}</td>
                        <td><span class="badge ${trans.points > 0 ? 'badge-success' : 'badge-danger'}">${trans.points > 0 ? '+' : ''}${trans.points}</span></td>
                        <td>${trans.reason || ''}</td>
                        <td>${trans.moderator || ''}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // ================= –û–ü–ï–†–ê–¶–ò–ò –û–†–ì–ê–ù–ò–ó–ê–¢–û–†–ê =================
        function quickAddPoints(points, reason) {
            const teamId = document.getElementById('quickTeamSelect').value;
            
            if (!teamId) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É', 'warning');
                return;
            }
            
            document.getElementById('manualTeamSelect').value = teamId;
            document.getElementById('pointsInput').value = points;
            document.getElementById('reasonInput').value = reason;
            
            manualAddPoints();
        }

        async function manualAddPoints() {
            const teamId = document.getElementById('manualTeamSelect').value;
            const points = parseInt(document.getElementById('pointsInput').value);
            const reason = document.getElementById('reasonInput').value.trim();
            const moderator = document.getElementById('moderatorInput').value.trim();
            const password = document.getElementById('adminPassword').value;
            
            if (!teamId || isNaN(points) || !reason || !moderator) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (!password) {
                showNotification('–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞', 'error');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch(CONFIG.SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'addPoints',
                        teamId: teamId,
                        points: points,
                        reason: reason,
                        moderator: moderator,
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(result.data.message, 'success');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª—è
                    document.getElementById('pointsInput').value = '';
                    document.getElementById('reasonInput').value = '';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    loadAdminData();
                } else {
                    showNotification(result.data?.error || '–û—à–∏–±–∫–∞', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
                console.error('–û—à–∏–±–∫–∞:', error);
            } finally {
                hideLoading();
            }
        }

        function showAddTeamModal() {
            document.getElementById('addTeamModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function addNewTeam() {
            const name = document.getElementById('newTeamName').value.trim();
            const code = document.getElementById('newTeamCode').value.trim().toUpperCase();
            const contact = document.getElementById('newTeamContact').value.trim();
            
            if (!name || !code) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–æ–¥ –∫–æ–º–∞–Ω–¥—ã', 'error');
                return;
            }
            
            if (code.length !== 6) {
                showNotification('–ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
            // –ü–æ–∫–∞–∂–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ —Å–±—Ä–æ—Å–∏–º —Ñ–æ—Ä–º—É
            showNotification(`–ö–æ–º–∞–Ω–¥–∞ "${name}" –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å –∫–æ–¥–æ–º ${code}`, 'success');
            
            document.getElementById('newTeamName').value = '';
            document.getElementById('newTeamCode').value = '';
            document.getElementById('newTeamContact').value = '';
            
            closeModal('addTeamModal');
            loadAdminData(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
        }

        function editTeam(teamId) {
            const team = currentState.allTeams.find(t => t.id == teamId);
            if (team) {
                document.getElementById('newTeamName').value = team.name;
                document.getElementById('newTeamCode').value = team.code;
                document.getElementById('newTeamContact').value = team.contact || '';
                document.getElementById('addTeamModal').classList.add('active');
            }
        }

        function addPointsToTeam(teamId) {
            document.getElementById('quickTeamSelect').value = teamId;
            document.getElementById('manualTeamSelect').value = teamId;
            showNotification(`–í—ã–±—Ä–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ ID: ${teamId}. –¢–µ–ø–µ—Ä—å –Ω–∞—á–∏—Å–ª–∏—Ç–µ –±–∞–ª–ª—ã.`, 'info');
        }

        // ================= –£–¢–ò–õ–ò–¢–´ =================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function showLoading() {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            document.body.style.cursor = 'wait';
        }

        function hideLoading() {
            document.body.style.cursor = 'default';
        }

        function refreshData() {
            if (currentState.team) {
                loadTeamData();
                showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            } else if (currentState.isAdmin) {
                loadAdminData();
                showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            }
        }

        function startAutoRefresh() {
            stopAutoRefresh();
            window.refreshInterval = setInterval(refreshData, CONFIG.REFRESH_INTERVAL);
        }

        function stopAutoRefresh() {
            if (window.refreshInterval) {
                clearInterval(window.refreshInterval);
                window.refreshInterval = null;
            }
        }

        // ================= PWA –§–£–ù–ö–¶–ò–ò =================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(error => {
                    console.log('Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', error);
                });
            });
        }

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫
        window.loginAsTeam = loginAsTeam;
        window.loginAsAdmin = loginAsAdmin;
        window.logout = logout;
        window.refreshData = refreshData;
        window.quickAddPoints = quickAddPoints;
        window.manualAddPoints = manualAddPoints;
        window.showAddTeamModal = showAddTeamModal;
        window.closeModal = closeModal;
        window.addNewTeam = addNewTeam;
        window.editTeam = editTeam;
        window.addPointsToTeam = addPointsToTeam;
    </script>
</body>
</html>